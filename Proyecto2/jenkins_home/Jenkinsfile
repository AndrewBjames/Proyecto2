pipeline {
  agent any
  options { timestamps() } // logs con hora

  environment {
    // Tu docker-compose está dentro de la carpeta Proyecto2
    COMPOSE_FILE = "Proyecto2/docker-compose.yml"

    // ID de credenciales en Jenkins (Username/Password)
    DOCKER_CREDS_ID = "dockerhub-creds"
  }

  stages {

    stage('Checkout') {
      steps {
        // Trae el repo desde GitHub
        checkout scm
      }
    }

    stage('Build (5 imágenes)') {
      steps {
        bat """
@echo on
echo ===== BUILD (5 IMAGENES) =====
docker compose -f "%COMPOSE_FILE%" build
IF %ERRORLEVEL% NEQ 0 EXIT /B 1
"""
      }
    }

    stage('Login Docker Hub') {
      steps {
        // Usa credenciales guardadas en Jenkins
        withCredentials([usernamePassword(
          credentialsId: DOCKER_CREDS_ID,
          usernameVariable: 'DOCKER_USER',
          passwordVariable: 'DOCKER_PASS'
        )]) {
          bat """
@echo on
echo ===== LOGIN DOCKER HUB =====
echo %DOCKER_PASS% | docker login -u %DOCKER_USER% --password-stdin
IF %ERRORLEVEL% NEQ 0 EXIT /B 1
"""
        }
      }
    }

    stage('Push (5 imágenes)') {
      steps {
        bat """
@echo on
echo ===== PUSH (5 IMAGENES) =====
docker compose -f "%COMPOSE_FILE%" push
IF %ERRORLEVEL% NEQ 0 EXIT /B 1
"""
      }
    }
  }

  post {
    always {
      bat """
@echo on
echo ===== FIN DEL PIPELINE =====
"""
    }
  }
}







