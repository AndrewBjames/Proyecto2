pipeline {
  agent any
  options { timestamps() }

  environment {
    // OJO: tu compose está dentro de la carpeta Proyecto2
    COMPOSE_FILE = "Proyecto2/docker-compose.yml"
    DOCKER_CREDS_ID = "dockerhub-creds"
  }

  stages {
    stage('Checkout') {
      steps { checkout scm }
    }

    stage('Build (5 imágenes)') {
      steps {
        bat """
@echo on
echo ===== BUILD (5 IMAGENES) =====
docker compose -f "%COMPOSE_FILE%" build
IF %ERRORLEVEL% NEQ 0 EXIT /B 1
"""
      }
    }

    stage('Login Docker Hub') {
      steps {
        withCredentials([usernamePassword(
          credentialsId: DOCKER_CREDS_ID,
          usernameVariable: 'DOCKER_USER',
          passwordVariable: 'DOCKER_PASS'
        )]) {
          bat """
@echo on
echo ===== LOGIN =====
echo %DOCKER_PASS% | docker login -u %DOCKER_USER% --password-stdin
IF %ERRORLEVEL% NEQ 0 EXIT /B 1
"""
        }
      }
    }

    stage('Push (5 imágenes)') {
      steps {
        bat """
@echo on
echo ===== PUSH (5 IMAGENES) =====
docker compose -f "%COMPOSE_FILE%" push
IF %ERRORLEVEL% NEQ 0 EXIT /B 1
"""
      }
    }
  }

  post {
    always {
      bat """
@echo on
echo ===== FIN =====
docker logout
"""
    }
  }
}





